<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniConvert - All-in-One File Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #f8fafc; /* Slate 50 */
        }
        /* Aurora background effect */
        .aurora-bg {
            background: #0f172a;
            position: relative;
            overflow: hidden;
        }
        .aurora-bg::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            background-image: radial-gradient(circle at center, rgba(79, 70, 229, 0.2) 0%, rgba(79, 70, 229, 0) 40%);
            animation: aurora 15s linear infinite;
            transform-origin: center;
        }
        @keyframes aurora {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        .tool-tab.active {
            background-color: #4f46e5;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }
        .drop-zone { transition: all 0.3s ease; }
        .drop-zone-dragover { 
            border-color: #4f46e5; 
            background-color: #1e293b;
            transform: scale(1.02);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        
        /* Splash Screen Style */
        .splash-fade-out {
            opacity: 0;
            pointer-events: none;
        }

        /* Progress Bar */
        .progress-bar {
            background-color: #334155;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar-inner {
            background-color: #4f46e5;
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        /* File list styling */
        .file-list-item {
            background-color: #1e293b;
            border: 1px solid #334155;
        }
        .file-list-item img {
            width: 32px;
            height: 32px;
            object-fit: cover;
            border-radius: 4px;
        }
    </style>
</head>
<body class="antialiased aurora-bg">
    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 bg-slate-900 flex flex-col items-center justify-center z-50 transition-opacity duration-1000 ease-in-out">
        <div id="lottie-animation" class="w-96 h-96"></div>
        <h1 class="text-3xl font-bold text-white tracking-tight -mt-12">Omni<span class="text-indigo-400">Convert</span></h1>
        <p class="text-slate-400 mt-2">Loading your toolkit...</p>
    </div>

    <div class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8 relative z-10">
        <!-- Main Container -->
        <div class="w-full max-w-4xl bg-slate-900/70 backdrop-blur-xl border border-slate-700 rounded-2xl shadow-2xl overflow-hidden">
            
            <header class="p-6 border-b border-slate-700 text-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-white tracking-tight">Omni<span class="text-indigo-400">Convert</span></h1>
                <p class="text-slate-400 mt-2 text-sm sm:text-base">Your one-stop toolkit for modern file conversion.</p>
            </header>

            <main class="p-4 sm:p-6">
                <!-- Tool Navigation Tabs -->
                <div class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-6">
                     <button data-tool="compressor" class="tool-tab active flex items-center gap-2 px-4 py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-300 hover:bg-indigo-500 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                        Compressor
                    </button>
                    <button data-tool="converter" class="tool-tab flex items-center gap-2 px-4 py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-300 hover:bg-indigo-500 hover:text-white">
                       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"/><line x1="4" x2="21" y1="20" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" x2="21" y1="15" y2="21"/><line x1="4" x2="9" y1="4" y2="9"/></svg>
                        Converter
                    </button>
                     <button data-tool="resizer" class="tool-tab flex items-center gap-2 px-4 py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-300 hover:bg-indigo-500 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 10.5h-6m6 0v6m0-6-7 7m-1.5-1.5-6-6m0 0v6m0-6h6"/></svg>
                        Resizer
                    </button>
                    <button data-tool="pdf" class="tool-tab flex items-center gap-2 px-4 py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-300 hover:bg-indigo-500 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M10.4 12.6c.2.5.4.8.7 1s.7.3 1.1.3c.5 0 .9-.1 1.1-.4.2-.2.4-.6.4-.9 0-.4-.1-.7-.3-1-.2-.2-.5-.4-1-.5l-1-.3c-.8-.2-1.4-.6-1.9-1.1s-.7-1.1-.7-1.8c0-.7.3-1.3.8-1.8s1.2-.8 2.1-.8c.6 0 1.2.2 1.6.5s.8.8 1 1.4"/><path d="M16 12h-3v6h3"/></svg>
                        Image to PDF
                    </button>
                    <button data-tool="lottie" class="tool-tab flex items-center gap-2 px-4 py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-300 hover:bg-indigo-500 hover:text-white">
                       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3v4"/><path d="M19 17v4"/><path d="M12 3v4"/><path d="M5 17v4"/><path d="M19 3v4"/><path d="M12 17v4"/><rect width="20" height="8" x="2" y="8" rx="2"/></svg>
                        Lottie Viewer
                    </button>
                </div>

                <!-- Tool Panels Container -->
                <div id="tool-panels">
                    <!-- Image Compressor Tool -->
                    <div id="compressor-tool" class="tool-panel fade-in">
                        <div id="compressor-drop-zone" class="drop-zone bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer">
                            <input type="file" id="compressor-file-input" class="hidden" accept="image/png, image/jpeg, image/webp" multiple>
                            <div class="flex flex-col items-center text-slate-400">
                                <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                <p class="font-semibold">Drag & drop images here</p>
                                <p class="text-sm">or <span class="font-medium text-indigo-400">click to browse</span> or paste (<span class="font-mono">Ctrl+V</span>)</p>
                            </div>
                        </div>
                        <div id="compressor-batch-area" class="hidden mt-6">
                            <div id="compressor-file-list" class="space-y-2 max-h-48 overflow-y-auto pr-2"></div>
                            <div class="mt-4">
                                <label for="quality-slider" class="block text-sm font-medium text-slate-300 mb-2">Compression Quality: <span id="quality-value" class="font-bold text-indigo-400">75</span>%</label>
                                <input id="quality-slider" type="range" min="1" max="100" value="75" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <button id="compress-button" class="mt-4 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Compress Files</button>
                        </div>
                        <div id="compressor-progress-area" class="hidden mt-6 space-y-2">
                            <p id="compressor-progress-text" class="text-sm text-center text-slate-300">Compressing...</p>
                            <div class="progress-bar h-2 w-full"><div id="compressor-progress-bar" class="progress-bar-inner w-0"></div></div>
                        </div>
                        <div id="compressor-result" class="hidden mt-6"></div>
                    </div>
                    
                    <!-- Image Converter Tool -->
                    <div id="converter-tool" class="tool-panel hidden">
                        <div id="converter-drop-zone" class="drop-zone bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer">
                            <input type="file" id="converter-file-input" class="hidden" accept="image/*" multiple>
                            <div class="flex flex-col items-center text-slate-400">
                                <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M4 12h16M20 20v-5h-5"></path></svg>
                                <p class="font-semibold">Drag & drop images to convert</p>
                                <p class="text-sm">or <span class="font-medium text-indigo-400">click to browse</span> or paste (<span class="font-mono">Ctrl+V</span>)</p>
                            </div>
                        </div>
                        <div id="converter-batch-area" class="hidden mt-6">
                            <div id="converter-file-list" class="space-y-2 max-h-48 overflow-y-auto pr-2"></div>
                            <div class="mt-4">
                                <label for="convert-format-select" class="block text-sm font-medium text-slate-300 mb-2">Convert to:</label>
                                <select id="convert-format-select" class="w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white">
                                    <option value="image/png">PNG</option>
                                    <option value="image/jpeg">JPEG</option>
                                    <option value="image/webp">WEBP</option>
                                </select>
                            </div>
                            <button id="convert-button" class="mt-4 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Convert Files</button>
                        </div>
                        <div id="converter-progress-area" class="hidden mt-6 space-y-2">
                            <p id="converter-progress-text" class="text-sm text-center text-slate-300">Converting...</p>
                            <div class="progress-bar h-2 w-full"><div id="converter-progress-bar" class="progress-bar-inner w-0"></div></div>
                        </div>
                        <div id="converter-result" class="hidden mt-6"></div>
                    </div>

                    <!-- Image Resizer Tool -->
                    <div id="resizer-tool" class="tool-panel hidden">
                         <div id="resizer-drop-zone" class="drop-zone bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer">
                            <input type="file" id="resizer-file-input" class="hidden" accept="image/*" multiple>
                            <div class="flex flex-col items-center text-slate-400">
                                <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21H9.477a2 2 0 01-1.99-1.928l-1.04-9.375a2 2 0 011.99-2.072h4.225a2 2 0 011.831 1.139L15 10zM7 21h2m0 0h2m-2-2v-4m0 0H7"></path></svg>
                                <p class="font-semibold">Drag & drop images to resize</p>
                                <p class="text-sm">or <span class="font-medium text-indigo-400">click to browse</span> or paste (<span class="font-mono">Ctrl+V</span>)</p>
                            </div>
                        </div>
                        <div id="resizer-batch-area" class="hidden mt-6">
                            <div id="resizer-file-list" class="space-y-2 max-h-48 overflow-y-auto pr-2"></div>
                             <div class="mt-4 grid grid-cols-2 gap-4">
                                <div>
                                    <label for="resize-width" class="block text-sm font-medium text-slate-300 mb-1">Width (px)</label>
                                    <input type="number" id="resize-width" class="w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white" placeholder="e.g., 1920">
                                </div>
                                <div>
                                    <label for="resize-height" class="block text-sm font-medium text-slate-300 mb-1">Height (px)</label>
                                    <input type="number" id="resize-height" class="w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white" placeholder="e.g., 1080">
                                </div>
                             </div>
                            <div class="mt-2 flex items-center">
                                <input id="aspect-ratio-lock" type="checkbox" class="h-4 w-4 rounded border-slate-500 text-indigo-600 focus:ring-indigo-600" checked>
                                <label for="aspect-ratio-lock" class="ml-2 text-sm text-slate-300">Lock aspect ratio</label>
                            </div>
                            <button id="resize-button" class="mt-4 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Resize Files</button>
                        </div>
                        <div id="resizer-progress-area" class="hidden mt-6 space-y-2">
                            <p id="resizer-progress-text" class="text-sm text-center text-slate-300">Resizing...</p>
                            <div class="progress-bar h-2 w-full"><div id="resizer-progress-bar" class="progress-bar-inner w-0"></div></div>
                        </div>
                        <div id="resizer-result" class="hidden mt-6"></div>
                    </div>

                    <!-- Image to PDF Tool -->
                    <div id="pdf-tool" class="tool-panel hidden">
                        <div id="pdf-drop-zone" class="drop-zone bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer">
                            <input type="file" id="pdf-file-input" class="hidden" accept="image/*" multiple>
                            <div class="flex flex-col items-center text-slate-400">
                                <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                <p class="font-semibold">Drag & drop images to create a PDF</p>
                                <p class="text-sm">or <span class="font-medium text-indigo-400">click to browse</span> or paste (<span class="font-mono">Ctrl+V</span>)</p>
                            </div>
                        </div>
                        <div id="pdf-batch-area" class="hidden mt-6">
                            <div id="pdf-file-list" class="space-y-2 max-h-48 overflow-y-auto pr-2"></div>
                            <button id="pdf-button" class="mt-4 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Create PDF</button>
                        </div>
                        <div id="pdf-progress-area" class="hidden mt-6 space-y-2">
                            <p id="pdf-progress-text" class="text-sm text-center text-slate-300">Creating PDF...</p>
                            <div class="progress-bar h-2 w-full"><div id="pdf-progress-bar" class="progress-bar-inner w-0"></div></div>
                        </div>
                        <div id="pdf-result" class="hidden mt-6"></div>
                    </div>

                    <!-- Lottie Viewer Tool -->
                    <div id="lottie-tool" class="tool-panel hidden">
                        <div id="lottie-drop-zone" class="drop-zone bg-slate-800 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center cursor-pointer">
                             <input type="file" id="lottie-file-input" class="hidden" accept=".json">
                            <div class="flex flex-col items-center text-slate-400">
                                <svg class="w-12 h-12 mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.625a2.25 2.25 0 01-2.36 0l-7.5-4.625A2.25 2.25 0 012.25 6.993V6.75" /></svg>
                                <p class="font-semibold">Drag & drop your Lottie JSON file</p>
                                <p class="text-sm">or <span class="font-medium text-indigo-400">click to browse</span></p>
                            </div>
                        </div>
                        <div id="lottie-viewer-area" class="hidden mt-6">
                            <div id="lottie-render-area" style="background-color: #1e293b;" class="rounded-lg aspect-square w-full max-w-md mx-auto border-2 border-slate-700 transition-colors duration-300"></div>
                            <div id="lottie-info" class="text-xs text-slate-400 text-center mt-2 max-w-md mx-auto"></div>
                            <div class="max-w-md mx-auto my-2">
                                <div id="lottie-progress" class="progress-bar h-1 w-full"><div id="lottie-progress-bar" class="progress-bar-inner w-0 !transition-none"></div></div>
                            </div>
                            <div id="lottie-controls" class="mt-2 p-4 bg-slate-800 rounded-lg max-w-md mx-auto space-y-4">
                                <div class="flex items-center justify-center gap-4">
                                    <button id="play-pause-button" class="flex items-center justify-center w-12 h-12 bg-indigo-600 rounded-full text-white hover:bg-indigo-700 transition-colors">
                                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.647c1.295.742 1.295 2.545 0 3.286L7.279 20.99c-1.25.717-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" /></svg>
                                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden"><path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 01.75.75v12a.75.75 0 01-1.5 0v-12a.75.75 0 01.75-.75zm9 0a.75.75 0 01.75.75v12a.75.75 0 01-1.5 0v-12a.75.75 0 01.75-.75z" clip-rule="evenodd" /></svg>
                                    </button>
                                     <button id="stop-button" class="flex items-center justify-center w-12 h-12 bg-slate-600 rounded-full text-white hover:bg-slate-500 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M4.5 7.5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-9a3 3 0 01-3-3v-9z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-4 items-center">
                                    <div class="flex items-center gap-2">
                                        <label for="loop-toggle" class="text-sm font-medium text-slate-300">Loop</label>
                                        <input id="loop-toggle" type="checkbox" class="h-4 w-4 rounded border-slate-500 text-indigo-600 focus:ring-indigo-600">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="lottie-bg-color" class="text-sm font-medium text-slate-300">BG</label>
                                        <input id="lottie-bg-color" type="color" value="#1e293b" class="w-8 h-8 p-0 border-none rounded cursor-pointer bg-transparent">
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <label for="speed-slider" class="text-sm font-medium text-slate-300">Speed: <span id="speed-value">1.0</span>x</label>
                                    <input id="speed-slider" type="range" min="0.1" max="3" step="0.1" value="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                </div>
                                <button id="lottie-reset-button" class="w-full text-center bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-700 transition-colors duration-300">Load New File</button>
                            </div>
                        </div>
                         <div id="lottie-error-area" class="hidden mt-6 text-center p-4 bg-red-900/50 text-red-300 rounded-lg"></div>
                    </div>
                </div>
            </main>
        </div>
        <footer class="text-center mt-6">
            <p class="text-slate-500 text-sm">Built with ❤️ and modern web tech.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splash-screen');
            const lottieContainer = document.getElementById('lottie-animation');

            lottie.loadAnimation({
                container: lottieContainer,
                renderer: 'svg',
                loop: true,
                autoplay: true,
                path: 'https://assets6.lottiefiles.com/packages/lf20_p1qiuawe.json'
            });

            setTimeout(() => {
                splashScreen.classList.add('splash-fade-out');
            }, 2800);

            const { jsPDF } = window.jspdf;
            const toolTabs = document.querySelectorAll('.tool-tab');
            const toolPanels = document.querySelectorAll('.tool-panel');
            
            // --- Global State ---
            let fileStore = {
                compressor: [],
                converter: [],
                resizer: [],
                pdf: []
            };
            let lottieAnimationInstance = null;

            // --- Tab Navigation ---
            toolTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tool = tab.dataset.tool;
                    toolTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    toolPanels.forEach(panel => {
                        panel.classList.toggle('hidden', panel.id !== `${tool}-tool`);
                        if(panel.id === `${tool}-tool`) panel.classList.add('fade-in');
                    });
                });
            });
            
            // --- Utility Functions ---
            const formatBytes = (bytes, decimals = 2) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
            };
            
            const launchConfetti = () => confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });

            const createResultCard = (title, content, links = [], onReset) => {
                const linkButtons = links.map(link => `<a href="${link.href}" download="${link.download}" class="w-full text-center bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300">${link.text}</a>`).join('');
                const card = `
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 fade-in">
                        <h3 class="font-semibold text-lg mb-3">${title}</h3>
                        <div class="space-y-2 text-sm text-slate-300">${content}</div>
                        <div class="mt-4 flex flex-col sm:flex-row gap-3">
                            ${linkButtons}
                            <button class="reset-button w-full text-center bg-slate-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-700 transition-colors duration-300">Start Over</button>
                        </div>
                    </div>`;
                setTimeout(() => {
                    document.querySelector('.reset-button')?.addEventListener('click', onReset);
                }, 0);
                return card;
            };

             let renderFileList = (tool) => {
                const files = fileStore[tool];
                const dropZone = document.getElementById(`${tool}-drop-zone`);
                const batchArea = document.getElementById(`${tool}-batch-area`);
                const fileListEl = document.getElementById(`${tool}-file-list`);
                const resultArea = document.getElementById(`${tool}-result`);

                dropZone.classList.toggle('hidden', files.length > 0);
                batchArea.classList.toggle('hidden', files.length === 0);
                if (resultArea) resultArea.classList.add('hidden');
                
                if (fileListEl) {
                    fileListEl.innerHTML = '';
                    files.forEach((file, index) => {
                        const listItem = document.createElement('div');
                        listItem.className = "file-list-item flex items-center justify-between p-2 rounded-md gap-2";
                        
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        img.onload = () => URL.revokeObjectURL(img.src);

                        const nameSpan = document.createElement('span');
                        nameSpan.className = "text-sm text-slate-300 truncate";
                        nameSpan.textContent = file.name;

                        const infoDiv = document.createElement('div');
                        infoDiv.className = "flex items-center gap-2 flex-shrink-0";
                        
                        const sizeSpan = document.createElement('span');
                        sizeSpan.className = "text-xs text-slate-400";
                        sizeSpan.textContent = formatBytes(file.size);

                        const removeButton = document.createElement('button');
                        removeButton.dataset.index = index;
                        removeButton.className = "remove-file text-red-400 hover:text-red-300 text-xl leading-none";
                        removeButton.innerHTML = '&times;';
                        removeButton.onclick = () => {
                            fileStore[tool].splice(index, 1);
                            renderFileList(tool);
                        };

                        listItem.appendChild(img);
                        listItem.appendChild(nameSpan);
                        infoDiv.appendChild(sizeSpan);
                        infoDiv.appendChild(removeButton);
                        listItem.appendChild(infoDiv);
                        fileListEl.appendChild(listItem);
                    });
                }
            };

            // --- Generic Tool Setup ---
            function setupImageTool(tool) {
                const dropZone = document.getElementById(`${tool}-drop-zone`);
                const fileInput = document.getElementById(`${tool}-file-input`);
                
                const handleFiles = (files) => {
                    fileStore[tool].push(...Array.from(files).filter(f => f.type.startsWith('image/')));
                    renderFileList(tool);
                };

                dropZone.onclick = () => fileInput.click();
                dropZone.ondragover = e => { e.preventDefault(); dropZone.classList.add('drop-zone-dragover'); };
                dropZone.ondragleave = e => { e.preventDefault(); dropZone.classList.remove('drop-zone-dragover'); };
                dropZone.ondrop = e => {
                    e.preventDefault();
                    dropZone.classList.remove('drop-zone-dragover');
                    if (e.dataTransfer.files.length) handleFiles(e.dataTransfer.files);
                };
                fileInput.onchange = e => { if (e.target.files.length) handleFiles(e.target.files); };
                
                document.addEventListener('paste', e => {
                    const currentToolId = document.querySelector('.tool-panel:not(.hidden)').id;
                    if (currentToolId === `${tool}-tool` && e.clipboardData.files.length > 0) {
                        e.preventDefault();
                        const files = Array.from(e.clipboardData.files).filter(f => f.type.startsWith('image/'));
                        if (files.length > 0) handleFiles(files);
                    }
                });
            }
            
            ['compressor', 'converter', 'resizer', 'pdf'].forEach(setupImageTool);

            // --- Image Compressor Logic ---
            const qualitySlider = document.getElementById('quality-slider');
            const qualityValue = document.getElementById('quality-value');
            qualitySlider.addEventListener('input', e => { qualityValue.textContent = e.target.value; });
            document.getElementById('compress-button').onclick = async () => {
                const tool = 'compressor';
                const files = fileStore[tool];
                if (files.length === 0) return;
                
                document.getElementById(`${tool}-batch-area`).classList.add('hidden');
                const progressArea = document.getElementById(`${tool}-progress-area`);
                progressArea.classList.remove('hidden');

                const quality = parseInt(qualitySlider.value, 10) / 100;
                const processedBlobs = [];
                let totalOriginalSize = 0, totalCompressedSize = 0;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    totalOriginalSize += file.size;
                    
                    const progress = ((i + 1) / files.length) * 100;
                    document.getElementById(`${tool}-progress-text`).textContent = `Compressing ${i + 1} of ${files.length}...`;
                    document.getElementById(`${tool}-progress-bar`).style.width = `${progress}%`;

                    const compressedBlob = await new Promise(resolve => {
                        const reader = new FileReader();
                        reader.onload = e => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                canvas.width = img.width; canvas.height = img.height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0);
                                canvas.toBlob(blob => resolve(blob), 'image/jpeg', quality);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                    totalCompressedSize += compressedBlob.size;
                    processedBlobs.push({ name: file.name.replace(/\.[^/.]+$/, "") + '.jpg', blob: compressedBlob });
                }
                
                launchConfetti();
                progressArea.classList.add('hidden');
                
                const reduction = totalOriginalSize > 0 ? ((totalOriginalSize - totalCompressedSize) / totalOriginalSize * 100).toFixed(1) : 0;
                let downloadLink;

                if (processedBlobs.length === 1) {
                    const url = URL.createObjectURL(processedBlobs[0].blob);
                    downloadLink = { href: url, download: processedBlobs[0].name, text: 'Download Compressed Image' };
                } else {
                    const zip = new JSZip();
                    processedBlobs.forEach(item => zip.file(item.name, item.blob));
                    const zipBlob = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(zipBlob);
                    downloadLink = { href: url, download: 'compressed-images.zip', text: 'Download All as .ZIP' };
                }
                
                const resultArea = document.getElementById(`${tool}-result`);
                resultArea.innerHTML = createResultCard('Compression Complete!', `<p>Processed ${processedBlobs.length} image(s).</p><p>Total original size: <strong>${formatBytes(totalOriginalSize)}</strong></p><p>Total compressed size: <strong class="text-green-400">${formatBytes(totalCompressedSize)}</strong></p><p>Overall reduction: <strong class="text-green-400">${reduction}%</strong></p>`, [downloadLink], () => {
                    fileStore[tool] = [];
                    renderFileList(tool);
                });
                resultArea.classList.remove('hidden');
            };

            // --- Image Converter Logic ---
            document.getElementById('convert-button').onclick = async () => {
                 const tool = 'converter';
                const files = fileStore[tool];
                if (files.length === 0) return;

                document.getElementById(`${tool}-batch-area`).classList.add('hidden');
                const progressArea = document.getElementById(`${tool}-progress-area`);
                progressArea.classList.remove('hidden');

                const format = document.getElementById('convert-format-select').value;
                const extension = format.split('/')[1];
                const processedBlobs = [];

                 for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const progress = ((i + 1) / files.length) * 100;
                    document.getElementById(`${tool}-progress-text`).textContent = `Converting ${i + 1} of ${files.length}...`;
                    document.getElementById(`${tool}-progress-bar`).style.width = `${progress}%`;
                    
                    const convertedBlob = await new Promise(resolve => {
                         const reader = new FileReader();
                        reader.onload = e => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                canvas.width = img.width; canvas.height = img.height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0);
                                canvas.toBlob(blob => resolve(blob), format);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                    processedBlobs.push({ name: file.name.replace(/\.[^/.]+$/, "") + `.${extension}`, blob: convertedBlob });
                 }

                launchConfetti();
                progressArea.classList.add('hidden');
                let downloadLink;

                if (processedBlobs.length === 1) {
                    const url = URL.createObjectURL(processedBlobs[0].blob);
                    downloadLink = { href: url, download: processedBlobs[0].name, text: 'Download Converted Image' };
                } else {
                    const zip = new JSZip();
                    processedBlobs.forEach(item => zip.file(item.name, item.blob));
                    const zipBlob = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(zipBlob);
                    downloadLink = { href: url, download: 'converted-images.zip', text: 'Download All as .ZIP' };
                }

                const resultArea = document.getElementById(`${tool}-result`);
                resultArea.innerHTML = createResultCard('Conversion Complete!', `<p>Converted ${processedBlobs.length} image(s) to ${extension.toUpperCase()}.</p>`, [downloadLink], () => {
                    fileStore[tool] = [];
                    renderFileList(tool);
                });
                resultArea.classList.remove('hidden');
            };

            // --- Image Resizer Logic ---
            const widthInput = document.getElementById('resize-width');
            const heightInput = document.getElementById('resize-height');
            const aspectLock = document.getElementById('aspect-ratio-lock');
            let originalRatios = {};

            widthInput.oninput = () => {
                if (aspectLock.checked && fileStore.resizer.length > 0 && originalRatios[fileStore.resizer[0].name]) {
                    heightInput.value = Math.round(widthInput.value / originalRatios[fileStore.resizer[0].name]);
                }
            };
            heightInput.oninput = () => {
                if (aspectLock.checked && fileStore.resizer.length > 0 && originalRatios[fileStore.resizer[0].name]) {
                    widthInput.value = Math.round(heightInput.value * originalRatios[fileStore.resizer[0].name]);
                }
            };
            
            // Overwrite renderFileList to add specific logic for the resizer tool
            const originalRenderFileList = renderFileList;
            renderFileList = (tool) => {
                if (tool === 'resizer' && fileStore.resizer.length > 0 && !originalRatios[fileStore.resizer[0].name]) {
                    const file = fileStore.resizer[0];
                    const img = new Image();
                    img.onload = () => {
                        originalRatios[file.name] = img.width / img.height;
                        if (!widthInput.value && !heightInput.value) {
                            widthInput.value = img.width;
                        }
                        if (aspectLock.checked) {
                           heightInput.value = Math.round(widthInput.value / originalRatios[file.name]);
                        }
                        URL.revokeObjectURL(img.src);
                    };
                    img.src = URL.createObjectURL(file);
                }
                originalRenderFileList(tool);
            };

            document.getElementById('resize-button').onclick = async () => {
                const tool = 'resizer';
                const files = fileStore[tool];
                const width = parseInt(widthInput.value);
                const height = parseInt(heightInput.value);
                if (files.length === 0 || !width || !height) return;

                document.getElementById(`${tool}-batch-area`).classList.add('hidden');
                const progressArea = document.getElementById(`${tool}-progress-area`);
                progressArea.classList.remove('hidden');

                const processedBlobs = [];
                 for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const progress = ((i + 1) / files.length) * 100;
                    document.getElementById(`${tool}-progress-text`).textContent = `Resizing ${i + 1} of ${files.length}...`;
                    document.getElementById(`${tool}-progress-bar`).style.width = `${progress}%`;
                    
                    const resizedBlob = await new Promise(resolve => {
                         const reader = new FileReader();
                        reader.onload = e => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                canvas.width = width; canvas.height = height;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);
                                canvas.toBlob(blob => resolve(blob), file.type);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                    processedBlobs.push({ name: `resized-${file.name}`, blob: resizedBlob });
                 }
                
                launchConfetti();
                progressArea.classList.add('hidden');
                let downloadLink;

                if (processedBlobs.length === 1) {
                    const url = URL.createObjectURL(processedBlobs[0].blob);
                    downloadLink = { href: url, download: processedBlobs[0].name, text: 'Download Resized Image' };
                } else {
                    const zip = new JSZip();
                    processedBlobs.forEach(item => zip.file(item.name, item.blob));
                    const zipBlob = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(zipBlob);
                    downloadLink = { href: url, download: 'resized-images.zip', text: 'Download All as .ZIP' };
                }

                const resultArea = document.getElementById(`${tool}-result`);
                resultArea.innerHTML = createResultCard('Resize Complete!', `<p>Resized ${processedBlobs.length} image(s) to ${width}x${height}px.</p>`, [downloadLink], () => {
                    fileStore[tool] = [];
                    renderFileList(tool);
                    widthInput.value = '';
                    heightInput.value = '';
                    originalRatios = {};
                });
                resultArea.classList.remove('hidden');
            };

            // --- Image to PDF Logic ---
            document.getElementById('pdf-button').onclick = async () => {
                const tool = 'pdf';
                const files = fileStore[tool];
                if (files.length === 0) return;

                document.getElementById(`${tool}-batch-area`).classList.add('hidden');
                const progressArea = document.getElementById(`${tool}-progress-area`);
                progressArea.classList.remove('hidden');
                
                const pdf = new jsPDF();
                for(let i=0; i<files.length; i++) {
                    const file = files[i];
                    const progress = ((i + 1) / files.length) * 100;
                    document.getElementById(`${tool}-progress-text`).textContent = `Adding image ${i + 1} of ${files.length}...`;
                    document.getElementById(`${tool}-progress-bar`).style.width = `${progress}%`;

                    const imageData = await new Promise(resolve => {
                        const reader = new FileReader();
                        reader.onload = e => resolve(e.target.result);
                        reader.readAsDataURL(file);
                    });
                    
                    const imgProps = await new Promise(resolve => {
                        const img = new Image();
                        img.onload = () => resolve({width: img.width, height: img.height});
                        img.src = imageData;
                    });

                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const ratio = imgProps.width / imgProps.height;
                    const pdfRatio = pdfWidth / pdfHeight;

                    let imgWidth, imgHeight;
                    if(ratio > pdfRatio) {
                        imgWidth = pdfWidth;
                        imgHeight = pdfWidth / ratio;
                    } else {
                        imgHeight = pdfHeight;
                        imgWidth = pdfHeight * ratio;
                    }
                    
                    if (i > 0) pdf.addPage();
                    pdf.addImage(imageData, 'JPEG', (pdfWidth - imgWidth) / 2, (pdfHeight - imgHeight) / 2, imgWidth, imgHeight);
                }
                
                launchConfetti();
                progressArea.classList.add('hidden');
                
                const pdfBlob = pdf.output('blob');
                const url = URL.createObjectURL(pdfBlob);
                const downloadLink = { href: url, download: 'converted.pdf', text: 'Download PDF' };

                const resultArea = document.getElementById(`${tool}-result`);
                resultArea.innerHTML = createResultCard('PDF Created!', `<p>Combined ${files.length} image(s) into a single PDF.</p>`, [downloadLink], () => {
                    fileStore[tool] = [];
                    renderFileList(tool);
                });
                resultArea.classList.remove('hidden');
            };

            // --- Lottie Viewer Logic ---
            const lottieDropZone = document.getElementById('lottie-drop-zone');
            const lottieFileInput = document.getElementById('lottie-file-input');
            const lottieViewerArea = document.getElementById('lottie-viewer-area');
            const lottieRenderArea = document.getElementById('lottie-render-area');
            const lottieErrorArea = document.getElementById('lottie-error-area');
            const playPauseButton = document.getElementById('play-pause-button');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            const stopButton = document.getElementById('stop-button');
            const loopToggle = document.getElementById('loop-toggle');
            const speedSlider = document.getElementById('speed-slider');
            const speedValue = document.getElementById('speed-value');
            const lottieResetButton = document.getElementById('lottie-reset-button');
            const lottieBgColor = document.getElementById('lottie-bg-color');
            const lottieInfo = document.getElementById('lottie-info');
            const lottieProgressBar = document.getElementById('lottie-progress-bar');
            
            const renderLottieAnimation = (animData) => {
                if(lottieAnimationInstance) lottieAnimationInstance.destroy();
                lottieRenderArea.innerHTML = '';
                
                try {
                    lottieAnimationInstance = lottie.loadAnimation({
                        container: lottieRenderArea,
                        renderer: 'svg',
                        loop: loopToggle.checked,
                        autoplay: true,
                        animationData: animData
                    });

                    lottieAnimationInstance.setSpeed(parseFloat(speedSlider.value));
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');

                    const { w, h, fr, op } = animData;
                    const duration = op / fr;
                    lottieInfo.textContent = `${w}x${h} @ ${fr}fps | ${duration.toFixed(2)}s | Frame: 0/${op}`;
                    
                    lottieAnimationInstance.addEventListener('enterFrame', () => {
                        const currentFrame = Math.floor(lottieAnimationInstance.currentFrame);
                        const totalFrames = lottieAnimationInstance.totalFrames;
                        lottieInfo.textContent = `${w}x${h} @ ${fr}fps | ${duration.toFixed(2)}s | Frame: ${currentFrame}/${totalFrames}`;
                        lottieProgressBar.style.width = `${(currentFrame / totalFrames) * 100}%`;
                    });

                     lottieAnimationInstance.addEventListener('complete', () => {
                        if(!lottieAnimationInstance.loop) {
                            playIcon.classList.remove('hidden');
                            pauseIcon.classList.add('hidden');
                        }
                    });

                } catch(e) {
                    lottieErrorArea.textContent = 'Invalid Lottie JSON file. Please check the file and try again.';
                    lottieErrorArea.classList.remove('hidden');
                }
            };
            
            const handleLottieFile = (file) => {
                if (!file || !file.name.endsWith('.json')) {
                    lottieErrorArea.textContent = 'Please upload a valid .json file.';
                    lottieErrorArea.classList.remove('hidden');
                    return;
                }
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const animData = JSON.parse(e.target.result);
                        lottieDropZone.classList.add('hidden');
                        lottieErrorArea.classList.add('hidden');
                        lottieViewerArea.classList.remove('hidden');
                        renderLottieAnimation(animData);
                    } catch (err) {
                        lottieErrorArea.textContent = 'Invalid Lottie JSON file. Please check the file and try again.';
                        lottieErrorArea.classList.remove('hidden');
                    }
                };
                reader.readAsText(file);
            };

            lottieDropZone.onclick = () => lottieFileInput.click();
            lottieDropZone.ondragover = e => { e.preventDefault(); lottieDropZone.classList.add('drop-zone-dragover'); };
            lottieDropZone.ondragleave = e => { e.preventDefault(); lottieDropZone.classList.remove('drop-zone-dragover'); };
            lottieDropZone.ondrop = e => {
                e.preventDefault();
                lottieDropZone.classList.remove('drop-zone-dragover');
                if (e.dataTransfer.files.length) handleLottieFile(e.dataTransfer.files[0]);
            };
            lottieFileInput.onchange = e => { if (e.target.files.length) handleLottieFile(e.target.files[0]); };

            playPauseButton.addEventListener('click', () => {
                if (!lottieAnimationInstance) return;

                if (pauseIcon.classList.contains('hidden')) {
                    const isFinished = lottieAnimationInstance.currentFrame >= lottieAnimationInstance.totalFrames - 1;
                    if(isFinished && !lottieAnimationInstance.loop) {
                        lottieAnimationInstance.goToAndPlay(0);
                    } else {
                        lottieAnimationInstance.play();
                    }
                    pauseIcon.classList.remove('hidden');
                    playIcon.classList.add('hidden');
                } else { 
                    lottieAnimationInstance.pause();
                    pauseIcon.classList.add('hidden');
                    playIcon.classList.remove('hidden');
                }
            });
            stopButton.addEventListener('click', () => {
                if (!lottieAnimationInstance) return;
                lottieAnimationInstance.stop();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                lottieProgressBar.style.width = '0%';
            });
            loopToggle.addEventListener('change', () => { if(lottieAnimationInstance) lottieAnimationInstance.loop = loopToggle.checked; });
            speedSlider.addEventListener('input', () => {
                const speed = parseFloat(speedSlider.value);
                speedValue.textContent = speed.toFixed(1);
                if(lottieAnimationInstance) lottieAnimationInstance.setSpeed(speed);
            });
            lottieBgColor.addEventListener('input', (e) => { lottieRenderArea.style.backgroundColor = e.target.value; });
            const resetLottieViewer = () => {
                if(lottieAnimationInstance) lottieAnimationInstance.destroy();
                lottieAnimationInstance = null;
                lottieDropZone.classList.remove('hidden');
                lottieViewerArea.classList.add('hidden');
                lottieErrorArea.classList.add('hidden');
                lottieFileInput.value = '';
                lottieInfo.textContent = '';
                lottieProgressBar.style.width = '0%';
            };
            lottieResetButton.addEventListener('click', resetLottieViewer);
        });
    </script>
</body>
</html>

